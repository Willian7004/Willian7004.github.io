<!DOCTYPE html>
<!--
写一个html程序，生成雪花动画。每个雪花随机选择样式和缩放比例，在菜单设置风力效果（使用一个滑块，中间表示无风）和雪花生成频率。

注：已手动调参。原扰动函数对所有雪花效果一致，改为随机扰动。
-->
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雪花动画</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(to bottom, #0f2350, #1a3a7a);
            font-family: Arial, sans-serif;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        .controls {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 20px;
            z-index: 2;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
        }
        
        label {
            margin-bottom: 5px;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        input[type="range"] {
            width: 150px;
            cursor: pointer;
        }
        
        .value-display {
            margin-top: 5px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body>
    <canvas id="snowCanvas"></canvas>
    
    <div class="controls">
        <div class="control-group">
            <label for="windSlider">风力</label>
            <input type="range" id="windSlider" min="-2" max="2" step="0.1" value="0">
            <div class="value-display" id="windValue">0</div>
        </div>
        
        <div class="control-group">
            <label for="frequencySlider">雪花频率</label>
            <input type="range" id="frequencySlider" min="1" max="60" step="1" value="20">
            <div class="value-display" id="frequencyValue">20</div>
        </div>
    </div>

    <script>
        // 获取画布和上下文
        const canvas = document.getElementById('snowCanvas');
        const ctx = canvas.getContext('2d');
        
        // 设置画布尺寸
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // 雪花类
        class Snowflake {
            constructor() {
                this.reset();
            }
            
            reset() {
                // 随机雪花样式和缩放
                this.style = Math.floor(Math.random() * 3); // 0, 1, 2 for different styles
                this.scale = Math.random() * 1.5 + 0.5; // 0.5 to 2
                // 扩展生成区域到画布左右两侧
                this.x = Math.random() * (canvas.width + 1800) - 1800; // -900 到 canvas.width + 900
                this.y = -10;
                this.radius = Math.random() * 3 * this.scale + 1;
                this.speed = Math.random() * 1 * this.scale + 0.5;
                this.wind = 0;
                this.opacity = Math.random() * 0.5 + 0.5;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.02;
            }
            
            update(windForce) {
                this.y += this.speed;
                this.x += windForce;
                this.rotation += this.rotationSpeed;
                
                // 添加一些随机水平移动
                this.x += Math.random() ;
                
                // 如果雪花离开屏幕，重置
                if (this.y > canvas.height + 10) {
                    this.reset();
                }
                // 允许雪花在左右扩展区域移动
                if (this.x < -900 || this.x > canvas.width + 900) {
                    this.reset();
                }
            }
            
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.globalAlpha = this.opacity;
                
                // 根据样式绘制不同的雪花
                if (this.style === 0) {
                    // 简单圆形
                    ctx.beginPath();
                    ctx.arc(0, 0, this.radius*0.5, 0, Math.PI * 2);
                    ctx.fillStyle = 'white';
                    ctx.fill();
                } else if (this.style === 1) {
                    // 星形
                    this.drawStar(0, 0, 5, this.radius, this.radius / 2);
                } else {
                    // 六边形雪花
                    this.drawSnowflake(0, 0, this.radius * 2);
                }
                
                ctx.restore();
            }
            
            drawStar(cx, cy, spikes, outerRadius, innerRadius) {
                let rot = Math.PI / 2 * 3;
                let x = cx;
                let y = cy;
                const step = Math.PI / spikes;
                
                ctx.beginPath();
                ctx.moveTo(cx, cy - outerRadius);
                
                for (let i = 0; i < spikes; i++) {
                    x = cx + Math.cos(rot) * outerRadius;
                    y = cy + Math.sin(rot) * outerRadius;
                    ctx.lineTo(x, y);
                    rot += step;
                    
                    x = cx + Math.cos(rot) * innerRadius;
                    y = cy + Math.sin(rot) * innerRadius;
                    ctx.lineTo(x, y);
                    rot += step;
                }
                
                ctx.lineTo(cx, cy - outerRadius);
                ctx.closePath();
                ctx.fillStyle = 'white';
                ctx.fill();
            }
            
            drawSnowflake(cx, cy, size) {
                const halfSize = size / 2;
                
                // 绘制主干
                ctx.beginPath();
                ctx.moveTo(cx, cy - halfSize);
                ctx.lineTo(cx, cy + halfSize);
                ctx.moveTo(cx - halfSize * 0.866, cy - halfSize * 0.5);
                ctx.lineTo(cx + halfSize * 0.866, cy + halfSize * 0.5);
                ctx.moveTo(cx + halfSize * 0.866, cy - halfSize * 0.5);
                ctx.lineTo(cx - halfSize * 0.866, cy + halfSize * 0.5);
                
                ctx.lineWidth = size / 10;
                ctx.strokeStyle = 'white';
                ctx.stroke();
                
                // 添加装饰
                const branches = 6;
                for (let i = 0; i < branches; i++) {
                    const angle = i * Math.PI / 3;
                    const x1 = cx + Math.cos(angle) * halfSize * 0.6;
                    const y1 = cy + Math.sin(angle) * halfSize * 0.6;
                    
                    const x2 = cx + Math.cos(angle + Math.PI / 6) * halfSize * 0.4;
                    const y2 = cy + Math.sin(angle + Math.PI / 6) * halfSize * 0.4;
                    
                    const x3 = cx + Math.cos(angle - Math.PI / 6) * halfSize * 0.4;
                    const y3 = cy + Math.sin(angle - Math.PI / 6) * halfSize * 0.4;
                    
                    ctx.beginPath();
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x3, y3);
                    ctx.stroke();
                }
            }
        }
        
        // 雪花数组
        let snowflakes = [];
        let windForce = 0;
        let snowFrequency = 5;
        let frameCount = 0;
        
        // 控制元素
        const windSlider = document.getElementById('windSlider');
        const windValue = document.getElementById('windValue');
        const frequencySlider = document.getElementById('frequencySlider');
        const frequencyValue = document.getElementById('frequencyValue');
        
        // 事件监听器
        windSlider.addEventListener('input', function() {
            windForce = parseFloat(this.value);
            windValue.textContent = windForce.toFixed(1);
        });
        
        frequencySlider.addEventListener('input', function() {
            snowFrequency = parseInt(this.value);
            frequencyValue.textContent = snowFrequency;
        });
        
        // 动画循环
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 以指定频率添加新雪花
            frameCount++;
            if (frameCount % (30 / snowFrequency) === 0) {
                snowflakes.push(new Snowflake());
            }
            
            // 限制雪花数量以提高性能
            if (snowflakes.length > 800) {
                snowflakes = snowflakes.slice(0, 800);
            }
            
            // 更新并绘制雪花
            snowflakes.forEach(flake => {
                flake.update(windForce);
                flake.draw();
            });
            
            requestAnimationFrame(animate);
        }
        
        // 开始动画
        animate();
    </script>
</body>
</html>