<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBR森林场景</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #canvas {
            display: block;
        }
        
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px;
            border-radius: 10px;
            width: 250px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        input[type="range"] {
            width: 100%;
        }
        
        .value {
            display: inline-block;
            width: 50px;
            text-align: right;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div id="controls">
        <h3>场景控制面板</h3>
        
        <div class="control-group">
            <label>云层移动方向: <span class="value" id="cloudDirValue">0°</span></label>
            <input type="range" id="cloudDir" min="0" max="360" value="0">
        </div>
        
        <div class="control-group">
            <label>云层移动速度: <span class="value" id="cloudSpeedValue">1.0</span></label>
            <input type="range" id="cloudSpeed" min="0" max="5" step="0.1" value="1">
        </div>
        
        <div class="control-group">
            <label>太阳高度角: <span class="value" id="sunHeightValue">45°</span></label>
            <input type="range" id="sunHeight" min="0" max="90" value="45">
        </div>
        
        <div class="control-group">
            <label>摄像机视野: <span class="value" id="fovValue">75°</span></label>
            <input type="range" id="fov" min="30" max="120" value="75">
        </div>
    </div>

    <script src="../../libs/three.min.js"></script>
    <script>
        // 初始化场景、相机和渲染器
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.0;

        // 设置相机位置
        camera.position.set(0, 5, -40);
        camera.lookAt(0, 5, 0);

        // 创建天空球
        const skyGeometry = new THREE.SphereGeometry(500, 32, 32);
        const skyMaterial = new THREE.MeshBasicMaterial({
            color: 0x87CEEB,
            side: THREE.BackSide
        });
        const sky = new THREE.Mesh(skyGeometry, skyMaterial);
        scene.add(sky);

        // 创建太阳
        const sunGeometry = new THREE.SphereGeometry(5, 32, 32);
        const sunMaterial = new THREE.MeshBasicMaterial({
            color: 0xFFFF00,
            emissive: 0xFFFF00,
            emissiveIntensity: 1
        });
        const sun = new THREE.Mesh(sunGeometry, sunMaterial);
        scene.add(sun);

        // 太阳光源
        const sunLight = new THREE.DirectionalLight(0xFFFFFF, 1);
        sunLight.castShadow = true;
        sunLight.shadow.camera.left = -50;
        sunLight.shadow.camera.right = 50;
        sunLight.shadow.camera.top = 50;
        sunLight.shadow.camera.bottom = -50;
        sunLight.shadow.camera.near = 0.1;
        sunLight.shadow.camera.far = 200;
        sunLight.shadow.mapSize.width = 2048;
        sunLight.shadow.mapSize.height = 2048;
        scene.add(sunLight);

        // 环境光
        const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
        scene.add(ambientLight);

        // 创建地形
        const terrainGeometry = new THREE.PlaneGeometry(100, 100, 50, 50);
        const terrainMaterial = new THREE.MeshStandardMaterial({
            color: 0x3a5f3a,
            roughness: 0.8,
            metalness: 0.1
        });
        const terrain = new THREE.Mesh(terrainGeometry, terrainMaterial);
        terrain.rotation.x = -Math.PI / 2;
        terrain.receiveShadow = true;
        scene.add(terrain);

        // 创建云层
        const cloudGroup = new THREE.Group();
        const cloudMaterial = new THREE.MeshStandardMaterial({
            color: 0xFFFFFF,
            transparent: true,
            opacity: 0.7,
            roughness: 1,
            metalness: 0
        });

        for (let i = 0; i < 100; i++) {
            const cloudGeometry = new THREE.SphereGeometry(
                Math.random() * 3 + 2,
                8,
                6
            );
            const cloud = new THREE.Mesh(cloudGeometry, cloudMaterial);
            
            cloud.position.set(
                (Math.random() - 0.5) * 100,
                Math.random() * 20 + 10,
                (Math.random() - 0.5) * 100
            );
            
            cloud.scale.set(
                1 + Math.random() * 0.3,
                0.5 + Math.random() * 0.15,
                1 + Math.random() * 0.3
            );
            
            cloudGroup.add(cloud);
        }
        scene.add(cloudGroup);

        // 创建树木
        function createTree(x, z) {
            const treeGroup = new THREE.Group();
            
            // 树干
            const trunkGeometry = new THREE.CylinderGeometry(0.3, 0.5, 4, 8);
            const trunkMaterial = new THREE.MeshStandardMaterial({
                color: 0x8B4513,
                roughness: 0.9,
                metalness: 0.1
            });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            trunk.position.y = 2;
            trunk.castShadow = true;
            trunk.receiveShadow = true;
            treeGroup.add(trunk);
            
            // 树叶
            const leavesGeometry = new THREE.SphereGeometry(2, 8, 6);
            const leavesMaterial = new THREE.MeshStandardMaterial({
                color: 0x228B22,
                roughness: 0.8,
                metalness: 0.1
            });
            const leaves = new THREE.Mesh(leavesGeometry, leavesMaterial);
            leaves.position.y = 5;
            leaves.castShadow = true;
            leaves.receiveShadow = true;
            treeGroup.add(leaves);
            
            // 随机缩放
            const scale = 0.3 + Math.random() * 0.3;
            treeGroup.scale.set(scale, scale, scale);
            treeGroup.position.set(x, 0, z);
            
            return treeGroup;
        }

        // 创建森林
        for (let i = 0; i < 400; i++) {
            const x = (Math.random() - 0.5) * 80;
            const z = (Math.random() - 0.5) * 80;
            const tree = createTree(x, z);
            scene.add(tree);
        }

        // 控制变量
        let cloudDirection = 0;
        let cloudSpeed = 1;
        let sunHeight = 45;
        let fov = 75;

        // 事件监听器
        document.getElementById('cloudDir').addEventListener('input', (e) => {
            cloudDirection = e.target.value * Math.PI / 180;
            document.getElementById('cloudDirValue').textContent = e.target.value + '°';
        });

        document.getElementById('cloudSpeed').addEventListener('input', (e) => {
            cloudSpeed = parseFloat(e.target.value);
            document.getElementById('cloudSpeedValue').textContent = e.target.value;
        });

        document.getElementById('sunHeight').addEventListener('input', (e) => {
            sunHeight = parseFloat(e.target.value);
            document.getElementById('sunHeightValue').textContent = e.target.value + '°';
            updateSunPosition();
        });

        document.getElementById('fov').addEventListener('input', (e) => {
            fov = parseFloat(e.target.value);
            document.getElementById('fovValue').textContent = e.target.value + '°';
            camera.fov = fov;
            camera.updateProjectionMatrix();
        });

        function updateSunPosition() {
            const angle = sunHeight * Math.PI / 180;
            sun.position.x = Math.cos(angle) * 100;
            sun.position.y = Math.sin(angle) * 100;
            sun.position.z = 0;
            sunLight.position.copy(sun.position);
            
            // 更新天空颜色
            const intensity = Math.sin(angle) * 0.5 + 0.5;
            skyMaterial.color.setHSL(0.6, 0.5, 0.5 + intensity * 0.3);
        }

        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            
            // 移动云层
            const deltaX = Math.cos(cloudDirection) * cloudSpeed * 0.05;
            const deltaZ = Math.sin(cloudDirection) * cloudSpeed * 0.05;
            cloudGroup.children.forEach(cloud => {
                cloud.position.x += deltaX;
                cloud.position.z += deltaZ;
                
                // 边界检查
                if (cloud.position.x > 50) cloud.position.x = -50;
                if (cloud.position.x < -50) cloud.position.x = 50;
                if (cloud.position.z > 50) cloud.position.z = -50;
                if (cloud.position.z < -50) cloud.position.z = 50;
            });
            
            renderer.render(scene, camera);
        }

        // 窗口大小调整
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // 初始化
        updateSunPosition();
        animate();
    </script>
</body>
</html>