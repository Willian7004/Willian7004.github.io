<!DOCTYPE html>
<html lang="zh-CN">
<!--
æ ¹æ®ä»¥ä¸‹è¦æ±‚ï¼Œä½¿ç”¨htmlå†™ä¸€ä¸ªä»£ç ç¼–è¾‘å™¨ï¼š
1. å¦‚æœé¡µé¢ å®½åº¦>é«˜åº¦ é»˜è®¤åœ¨é¡µé¢å·¦åŠéƒ¨åˆ†ç¼–å†™htmlç¨‹åºï¼Œæ·»åŠ ä»£ç é«˜äº®åŠŸèƒ½ï¼Œåœ¨å³åŠéƒ¨åˆ†æ˜¾ç¤ºè¿è¡Œç»“æœï¼Œä¸¤éƒ¨åˆ†å æ¯”å¯é€šè¿‡æ‹–åŠ¨åˆ†ç•Œçº¿è¿›è¡Œè°ƒæ•´ï¼Œåœ¨ä¸¤ç«¯æ·»åŠ æŒ‰é’®ç”¨äºæ”¶èµ·å’Œå±•å¼€å¯¹åº”çš„éƒ¨åˆ†ã€‚å¦‚æœé¡µé¢ é«˜åº¦>å®½åº¦ åˆ™ä½¿ç”¨ä¸Šä¸‹åˆ†å±ã€‚
2. æ·»åŠ æ’¤é”€ã€é‡åšã€æŸ¥æ‰¾ã€æ›¿æ¢åŠŸèƒ½ã€‚è¡Œå·å’Œè‡ªåŠ¨æ¢è¡Œè®¾ä¸ºå¯å¼€å…³ã€‚
3. æ·»åŠ åŠ è½½å’Œä¸‹è½½å½“å‰é¡µé¢çš„åŠŸèƒ½ã€‚
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£ç ç¼–è¾‘å™¨</title>
    <!-- Prism.js ä»£ç é«˜äº® -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            overflow: hidden;
            background-color: #1e1e1e;
            color: #f0f0f0;
        }
        
        /* å®¹å™¨å¸ƒå±€ - é»˜è®¤å·¦å³åˆ†å± */
        .container {
            display: flex;
            height: 100vh;
            position: relative;
        }
        
        /* é«˜åº¦>å®½åº¦æ—¶åˆ‡æ¢ä¸Šä¸‹åˆ†å± */
        @media (max-aspect-ratio: 1/1) {
            .container {
                flex-direction: column;
            }
        }
        
        .pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        /* åˆ†å‰²çº¿ */
        .resize-handle {
            width: 10px;
            background: #444;
            cursor: col-resize;
            position: relative;
            z-index: 10;
        }
        
        @media (max-aspect-ratio: 1/1) {
            .resize-handle {
                width: 100%;
                height: 10px;
                cursor: row-resize;
            }
        }
        
        /* å·¥å…·æ æ ·å¼ */
        .toolbar {
            background: #252526;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #333;
        }
        
        .toolbar button {
            background: #3a3a3a;
            color: #fff;
            border: none;
            padding: 6px 12px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .toolbar button:hover {
            background: #4a4a4a;
        }
        
        .toolbar .toggle-btn {
            margin-left: auto;
        }
        
        /* ç¼–è¾‘å™¨åŒºåŸŸ */
        .editor-container {
            position: relative;
            flex: 1;
            overflow: auto;
            display: flex;
        }
        
        .line-numbers {
            width: 40px;
            background: #2d2d2d;
            color: #6a9955;
            text-align: right;
            padding: 15px 5px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow: hidden;
            border-right: 1px solid #444;
        }
        
        #editor {
            flex: 1;
            height: 100%;
            padding: 15px;
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            border: none;
            resize: none;
            white-space: pre;
            tab-size: 4;
        }
        
        #editor.wrap {
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        /* é¢„è§ˆåŒºåŸŸ */
        #preview {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
        }
        
        .modal-content h3 {
            margin-bottom: 15px;
            color: #e6e6e6;
        }
        
        .modal-content input {
            width: 100%;
            padding: 8px;
            margin: 8px 0;
            background: #3c3c3c;
            border: 1px solid #555;
            color: #fff;
            border-radius: 4px;
        }
        
        .modal-content button {
            background: #0078d4;
            color: white;
            border: none;
            padding: 8px 15px;
            margin-top: 10px;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç¼–è¾‘å™¨åŒºåŸŸ -->
        <div class="pane">
            <div class="toolbar">
                <button id="undoBtn" title="æ’¤é”€">â†© æ’¤é”€</button>
                <button id="redoBtn" title="é‡åš">â†ª é‡åš</button>
                <button id="findBtn" title="æŸ¥æ‰¾">ğŸ” æŸ¥æ‰¾</button>
                <button id="replaceBtn" title="æ›¿æ¢">ğŸ”„ æ›¿æ¢</button>
                <button id="lineNumbersBtn" title="è¡Œå·"># è¡Œå·</button>
                <button id="wordWrapBtn" title="è‡ªåŠ¨æ¢è¡Œ">â†© æ¢è¡Œ</button>
                <button id="loadBtn" title="åŠ è½½æ–‡ä»¶">ğŸ“‚ åŠ è½½</button>
                <button id="saveBtn" title="ä¿å­˜æ–‡ä»¶">ğŸ’¾ ä¿å­˜</button>
                <button class="toggle-btn" id="toggleEditorBtn" title="æ”¶èµ·ç¼–è¾‘å™¨">â—€</button>
            </div>
            <div class="editor-container">
                <div class="line-numbers" id="lineNumbers"></div>
                <textarea id="editor" spellcheck="false"><!DOCTYPE html>
<html>
<head>
    <title>æ¬¢è¿ä½¿ç”¨ä»£ç ç¼–è¾‘å™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            text-align: center;
            padding: 50px;
        }
        h1 {
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <h1>æ¬¢è¿ä½¿ç”¨ä»£ç ç¼–è¾‘å™¨</h1>
    <p>åœ¨å·¦ä¾§ç¼–è¾‘ä»£ç ï¼Œå³ä¾§æŸ¥çœ‹å®æ—¶é¢„è§ˆ</p>
</body>
</html></textarea>
            </div>
        </div>
        
        <!-- åˆ†å‰²çº¿ -->
        <div class="resize-handle" id="resizeHandle"></div>
        
        <!-- é¢„è§ˆåŒºåŸŸ -->
        <div class="pane">
            <div class="toolbar">
                <button id="runBtn" title="è¿è¡Œ">â–¶ è¿è¡Œ</button>
                <button class="toggle-btn" id="togglePreviewBtn" title="æ”¶èµ·é¢„è§ˆ">â–¶</button>
            </div>
            <iframe id="preview"></iframe>
        </div>
    </div>
    
    <!-- æŸ¥æ‰¾æ¨¡æ€æ¡† -->
    <div class="modal" id="findModal">
        <div class="modal-content">
            <h3>æŸ¥æ‰¾</h3>
            <input type="text" id="findInput" placeholder="è¾“å…¥è¦æŸ¥æ‰¾çš„å†…å®¹">
            <div>
                <button id="findNextBtn">æŸ¥æ‰¾ä¸‹ä¸€ä¸ª</button>
                <button id="findCancelBtn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- æ›¿æ¢æ¨¡æ€æ¡† -->
    <div class="modal" id="replaceModal">
        <div class="modal-content">
            <h3>æŸ¥æ‰¾å’Œæ›¿æ¢</h3>
            <input type="text" id="replaceFindInput" placeholder="æŸ¥æ‰¾å†…å®¹">
            <input type="text" id="replaceWithInput" placeholder="æ›¿æ¢ä¸º">
            <div>
                <button id="replaceBtnAction">æ›¿æ¢</button>
                <button id="replaceAllBtn">å…¨éƒ¨æ›¿æ¢</button>
                <button id="replaceCancelBtn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- æ–‡ä»¶è¾“å…¥ï¼ˆéšè—ï¼‰ -->
    <input type="file" id="fileInput" style="display: none;" accept=".html,.txt,.js,.css">
    
    <script>
        // DOMå…ƒç´ 
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const resizeHandle = document.getElementById('resizeHandle');
        const toggleEditorBtn = document.getElementById('toggleEditorBtn');
        const togglePreviewBtn = document.getElementById('togglePreviewBtn');
        const runBtn = document.getElementById('runBtn');
        const undoBtn = document.getElementById('undoBtn');
        const redoBtn = document.getElementById('redoBtn');
        const findBtn = document.getElementById('findBtn');
        const replaceBtn = document.getElementById('replaceBtn');
        const lineNumbersBtn = document.getElementById('lineNumbersBtn');
        const wordWrapBtn = document.getElementById('wordWrapBtn');
        const loadBtn = document.getElementById('loadBtn');
        const saveBtn = document.getElementById('saveBtn');
        const findModal = document.getElementById('findModal');
        const replaceModal = document.getElementById('replaceModal');
        const fileInput = document.getElementById('fileInput');
        const lineNumbersElement = document.getElementById('lineNumbers');
        
        // ç¼–è¾‘å™¨çŠ¶æ€
        let editorHistory = [];
        let historyPointer = -1;
        let isResizing = false;
        let isEditorCollapsed = false;
        let isPreviewCollapsed = false;
        let showLineNumbers = true;
        let wordWrap = false;
        
        // åˆå§‹åŒ–ç¼–è¾‘å™¨
        function initEditor() {
            // åˆå§‹åŒ–å†å²è®°å½•
            saveHistory();
            
            // åˆå§‹è¿è¡Œé¢„è§ˆ
            updatePreview();
            
            // æ›´æ–°è¡Œå·
            updateLineNumbers();
            
            // è®¾ç½®åˆå§‹æŒ‰é’®çŠ¶æ€
            toggleEditorBtn.style.display = isPreviewCollapsed ? 'block' : 'none';
            togglePreviewBtn.style.display = isEditorCollapsed ? 'block' : 'none';
            
            // äº‹ä»¶ç›‘å¬
            setupEventListeners();
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            // ç¼–è¾‘å™¨è¾“å…¥ç›‘å¬
            editor.addEventListener('input', () => {
                saveHistory();
                highlightCode();
                updateLineNumbers();
            });
            
            // ç¼–è¾‘å™¨æ»šåŠ¨åŒæ­¥
            editor.addEventListener('scroll', () => {
                lineNumbersElement.scrollTop = editor.scrollTop;
            });
            
            // è¿è¡ŒæŒ‰é’®
            runBtn.addEventListener('click', updatePreview);
            
            // æ’¤é”€/é‡åš
            undoBtn.addEventListener('click', undo);
            redoBtn.addEventListener('click', redo);
            
            // æŸ¥æ‰¾/æ›¿æ¢
            findBtn.addEventListener('click', () => findModal.style.display = 'flex');
            replaceBtn.addEventListener('click', () => replaceModal.style.display = 'flex');
            
            // è¡Œå·åˆ‡æ¢
            lineNumbersBtn.addEventListener('click', toggleLineNumbers);
            
            // è‡ªåŠ¨æ¢è¡Œåˆ‡æ¢
            wordWrapBtn.addEventListener('click', toggleWordWrap);
            
            // æ–‡ä»¶æ“ä½œ
            loadBtn.addEventListener('click', () => fileInput.click());
            saveBtn.addEventListener('click', saveFile);
            fileInput.addEventListener('change', loadFile);
            
            // æŠ˜å /å±•å¼€
            toggleEditorBtn.addEventListener('click', () => togglePane('editor'));
            togglePreviewBtn.addEventListener('click', () => togglePane('preview'));
            
            // æŸ¥æ‰¾/æ›¿æ¢æ¨¡æ€æ¡†
            document.getElementById('findCancelBtn').addEventListener('click', () => findModal.style.display = 'none');
            document.getElementById('replaceCancelBtn').addEventListener('click', () => replaceModal.style.display = 'none');
            document.getElementById('findNextBtn').addEventListener('click', findNext);
            document.getElementById('replaceBtnAction').addEventListener('click', replaceText);
            document.getElementById('replaceAllBtn').addEventListener('click', replaceAll);
            
            // åˆ†å‰²çº¿æ‹–åŠ¨
            resizeHandle.addEventListener('mousedown', startResize);
            window.addEventListener('mousemove', resize);
            window.addEventListener('mouseup', stopResize);
        }
        
        // ä¿å­˜å†å²è®°å½•
        function saveHistory() {
            // ä¿å­˜å½“å‰çŠ¶æ€åˆ°å†å²è®°å½•
            editorHistory = editorHistory.slice(0, historyPointer + 1);
            editorHistory.push(editor.value);
            historyPointer = editorHistory.length - 1;
        }
        
        // æ’¤é”€
        function undo() {
            if (historyPointer > 0) {
                historyPointer--;
                editor.value = editorHistory[historyPointer];
                highlightCode();
                updateLineNumbers();
            }
        }
        
        // é‡åš
        function redo() {
            if (historyPointer < editorHistory.length - 1) {
                historyPointer++;
                editor.value = editorHistory[historyPointer];
                highlightCode();
                updateLineNumbers();
            }
        }
        
        // æ›´æ–°è¡Œå·æ˜¾ç¤º
        function updateLineNumbers() {
            if (!showLineNumbers) {
                lineNumbersElement.innerHTML = '';
                return;
            }
            
            const lineCount = editor.value.split('\n').length;
            let numbersHTML = '';
            
            for (let i = 1; i <= lineCount; i++) {
                numbersHTML += `<div>${i}</div>`;
            }
            
            lineNumbersElement.innerHTML = numbersHTML;
        }
        
        // åˆ‡æ¢è¡Œå·æ˜¾ç¤º
        function toggleLineNumbers() {
            showLineNumbers = !showLineNumbers;
            lineNumbersElement.style.display = showLineNumbers ? 'block' : 'none';
            lineNumbersBtn.textContent = showLineNumbers ? '# è¡Œå·' : '# è¡Œå·';
            updateLineNumbers();
        }
        
        // åˆ‡æ¢è‡ªåŠ¨æ¢è¡Œ
        function toggleWordWrap() {
            wordWrap = !wordWrap;
            editor.classList.toggle('wrap', wordWrap);
            wordWrapBtn.textContent = wordWrap ? 'â†© æ¢è¡Œ' : 'â†© æ¢è¡Œ';
        }
        
        // ä»£ç é«˜äº®
        function highlightCode() {
            // ä½¿ç”¨Prism.jsè¿›è¡Œä»£ç é«˜äº®
            const highlighted = Prism.highlight(
                editor.value, 
                Prism.languages.html, 
                'html'
            );
        }
        
        // æ›´æ–°é¢„è§ˆï¼ˆä¿®å¤ä¸­æ–‡ä¹±ç ï¼‰
        function updatePreview() {
            const content = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    ${editor.value.includes('<head>') ? '' : '</head>'}
                    ${editor.value}
                </html>
            `;
            
            const blob = new Blob([content], { type: 'text/html' });
            preview.src = URL.createObjectURL(blob);
        }
        
        // åŠ è½½æ–‡ä»¶
        function loadFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                editor.value = e.target.result;
                saveHistory();
                updatePreview();
                highlightCode();
                updateLineNumbers();
            };
            reader.readAsText(file);
        }
        
        // ä¿å­˜æ–‡ä»¶
        function saveFile() {
            const content = editor.value;
            const blob = new Blob([content], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'code-editor.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
        
        // æŸ¥æ‰¾æ–‡æœ¬
        function findNext() {
            const text = document.getElementById('findInput').value;
            if (!text) return;
            
            const start = editor.selectionEnd;
            const content = editor.value;
            const index = content.indexOf(text, start);
            
            if (index >= 0) {
                editor.focus();
                editor.setSelectionRange(index, index + text.length);
            }
        }
        
        // æ›¿æ¢æ–‡æœ¬
        function replaceText() {
            const findText = document.getElementById('replaceFindInput').value;
            const replaceText = document.getElementById('replaceWithInput').value;
            
            if (!findText) return;
            
            const content = editor.value;
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            
            if (editor.value.substring(start, end) === findText) {
                editor.value = content.substring(0, start) + replaceText + content.substring(end);
                editor.setSelectionRange(start, start + replaceText.length);
                saveHistory();
                highlightCode();
                updateLineNumbers();
            }
        }
        
        // å…¨éƒ¨æ›¿æ¢
        function replaceAll() {
            const findText = document.getElementById('replaceFindInput').value;
            const replaceText = document.getElementById('replaceWithInput').value;
            
            if (!findText) return;
            
            const regex = new RegExp(findText, 'g');
            editor.value = editor.value.replace(regex, replaceText);
            saveHistory();
            highlightCode();
            updateLineNumbers();
            replaceModal.style.display = 'none';
        }
        
        // åˆ‡æ¢é¢æ¿æ˜¾ç¤ºï¼ˆä¿®å¤å±•å¼€æŒ‰é’®é€»è¾‘ï¼‰
        function togglePane(paneType) {
            const container = document.querySelector('.container');
            const editorPane = container.children[0];
            const previewPane = container.children[2];
            
            if (paneType === 'editor') {
                isEditorCollapsed = !isEditorCollapsed;
                editorPane.style.flex = isEditorCollapsed ? '0' : '1';
                toggleEditorBtn.textContent = isEditorCollapsed ? 'â–¶' : 'â—€';
                toggleEditorBtn.title = isEditorCollapsed ? 'å±•å¼€ç¼–è¾‘å™¨' : 'æ”¶èµ·ç¼–è¾‘å™¨';
                resizeHandle.style.display = isEditorCollapsed ? 'none' : 'block';
                
                // æ˜¾ç¤º/éšè—é¢„è§ˆåŒºåŸŸçš„å±•å¼€æŒ‰é’®
                togglePreviewBtn.style.display = isEditorCollapsed ? 'block' : 'none';
            } else {
                isPreviewCollapsed = !isPreviewCollapsed;
                previewPane.style.flex = isPreviewCollapsed ? '0' : '1';
                togglePreviewBtn.textContent = isPreviewCollapsed ? 'â—€' : 'â–¶';
                togglePreviewBtn.title = isPreviewCollapsed ? 'å±•å¼€é¢„è§ˆ' : 'æ”¶èµ·é¢„è§ˆ';
                resizeHandle.style.display = isPreviewCollapsed ? 'none' : 'block';
                
                // æ˜¾ç¤º/éšè—ç¼–è¾‘å™¨åŒºåŸŸçš„å±•å¼€æŒ‰é’®
                toggleEditorBtn.style.display = isPreviewCollapsed ? 'block' : 'none';
            }
        }
        
        // åˆ†å‰²çº¿æ‹–åŠ¨åŠŸèƒ½
        function startResize(e) {
            isResizing = true;
            document.body.style.cursor = window.innerWidth > window.innerHeight ? 'col-resize' : 'row-resize';
            e.preventDefault();
        }
        
        function resize(e) {
            if (!isResizing) return;
            
            const container = document.querySelector('.container');
            const editorPane = container.children[0];
            const previewPane = container.children[2];
            
            if (window.innerWidth > window.innerHeight) {
                // å·¦å³å¸ƒå±€
                const containerRect = container.getBoundingClientRect();
                const newWidth = e.clientX - containerRect.left;
                editorPane.style.flex = `0 0 ${newWidth}px`;
                previewPane.style.flex = '1';
            } else {
                // ä¸Šä¸‹å¸ƒå±€
                const containerRect = container.getBoundingClientRect();
                const newHeight = e.clientY - containerRect.top;
                editorPane.style.flex = `0 0 ${newHeight}px`;
                previewPane.style.flex = '1';
            }
        }
        
        function stopResize() {
            isResizing = false;
            document.body.style.cursor = 'default';
        }
        
        // åˆå§‹åŒ–ç¼–è¾‘å™¨
        window.onload = initEditor;
    </script>
</body>
</html>
