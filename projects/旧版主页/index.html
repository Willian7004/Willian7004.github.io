<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Willian7004的HTML项目</title>
    <script src="../../libs/marked.min.js"></script>
    <style>
        :root {
            --tool-color: #8fbcbb;
            --d2-color: #88c0d0;
            --d3-color: #81a1c1;
            --readme-color: #5e81ac;
            --card-bg: #2e3440;
            --page-bg: #3b4252;
            --text-color: #e5e9f0;
            --link-color: #ebcb8b;
            --link-hover: #a3be8c;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            background-color: var(--page-bg);
            color: var(--text-color);
            font-family: sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        .container {
            display: flex;
            width: 100%;
            height: 95vh;
        }
        /* 横向布局 (宽>高) */
        @media (min-aspect-ratio: 1/1) {
            .container {
                flex-direction: row;
            }
            .card {
                height: 95vh;
            }
        }
        /* 纵向布局 (宽<高) */
        @media (max-aspect-ratio: 1/1) {
            .container {
                flex-direction: column;
            }
            .card {
                width: 100%;
            }
        }
        .card {
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            margin: 5px;
            flex: 1;
        }
        .card-header {
            padding: 15px;
            font-weight: bold;
            font-size: 1.2em;
        }
        .card-content {
            padding: 15px;
            overflow-y: auto;
            flex-grow: 1;
        }
        .card.tool .card-header { background-color: var(--tool-color); }
        .card.d2 .card-header { background-color: var(--d2-color); }
        .card.d3 .card-header { background-color: var(--d3-color); }
        .card.readme .card-header { background-color: var(--readme-color); }
        
        /* 文件列表链接样式 */
        .card-content a {
            color: var(--link-color);
            text-decoration: none;
            display: block;
            padding: 5px 0;
            transition: color 0.3s;
        }
        a:hover { 
            color: var(--link-hover);
        }
        /* README链接样式 */
        #readme-content a {
            display: inline-block;
            padding: 0 3px;
        }
        a:hover { 
            color: var(--link-hover);
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="card tool">
            <div class="card-header">文章</div>
            <div class="card-content" id="tool-content"></div>
        </div>
        <div class="card d2">
            <div class="card-header">网页</div>
            <div class="card-content" id="d2-content"></div>
        </div>
        <div class="card d3">
            <div class="card-header">项目</div>
            <div class="card-content" id="d3-content"></div>
        </div>
        <div class="card readme">
            <div class="card-header">说明</div>
            <div class="card-content" id="readme-content"></div>
        </div>
    </div>

    <script>
        // 分别加载三个数据源
        Promise.all([
          fetch('../../data/articles.json').then(res => res.json()),
          fetch('../../data/pages.json').then(res => res.json()),
          fetch('../../data/projects.json').then(res => res.json())
        ]).then(([articlesData, pagesData, projectsData]) => {
          renderArticles(articlesData);
          renderPages(pagesData);
          renderProjects(projectsData);
        }).catch(error => {
          console.error('加载文件列表失败:', error);
        });

        // 去除文件扩展名
        function removeExtension(filename) {
          return filename.replace(/\.[^/.]+$/, "");
        }

        // 文章卡片处理
        function renderArticles(data) {
          const allArticles = [...data.pinned, ...Object.values(data.folders).flat()];
          allArticles.sort((a, b) => new Date(b.created) - new Date(a.created));
          
          renderList('tool-content', allArticles.map(item => ({
            name: removeExtension(item.name),
            path: `../../articles/${item.path.replace('.md', '.html')}`
          })));
        }

        // 网页卡片处理
        function renderPages(data) {
          const allPages = Object.values(data).flat();
          allPages.sort((a, b) => new Date(b.created) - new Date(a.created));
          
          renderList('d2-content', allPages.map(item => ({
            name: removeExtension(item.name),
            path: `../../pages/${item.path}`
          })));
        }

        // 项目卡片处理
        function renderProjects(data) {
          data.sort((a, b) => new Date(b.created) - new Date(a.created));
          
          renderList('d3-content', data.map(item => ({
            name: item.name,
            path: `../${item.path}/index.html`
          })));
        }

        // 通用列表渲染
        function renderList(containerId, items) {
          const container = document.getElementById(containerId);
          if (!container) return;
          
          container.innerHTML = '';
          items.forEach(item => {
            const link = document.createElement('a');
            link.href = item.path;
            link.target = "_blank";
            link.textContent = item.name;
            container.appendChild(link);
          });
        }

        // 渲染README.md
        fetch('../../README.md')
            .then(response => response.text())
            .then(markdown => {
                const readmeContainer = document.getElementById('readme-content');
                if (readmeContainer) {
                    readmeContainer.innerHTML = marked.parse(markdown);
                    
                    // 设置所有链接在新标签页打开
                    const links = readmeContainer.querySelectorAll('a');
                    links.forEach(link => {
                        link.target = '_blank';
                    });
                }
            })
            .catch(error => {
                console.error('加载README失败:', error);
            });
    </script>
</body>
</html>
